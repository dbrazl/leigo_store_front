{"ast":null,"code":"import { takeLatest, all, put, call, race } from \"redux-saga/effects\";\nimport api from \"../../../services/api\";\nimport history from \"../../../services/history\";\nimport { signInSuccess, signFailure, signUpSuccess, restoreAccountSuccess } from \"./actions\";\nimport errorHandler from \"../utils/errorHandler\";\nimport timer from \"../utils/timer\";\n\nfunction* signIn({\n  payload\n}) {\n  const body = payload.body;\n\n  const _ref = yield race({\n    response: call(api.post, \"/session\", body),\n    timeout: call(timer)\n  }),\n        response = _ref.response;\n\n  console.tron.log(response);\n\n  try {\n    const token = response.data.token;\n    api.defaults.headers.Authorization = \"Bearer \".concat(token);\n    yield put(signInSuccess(response.data));\n    history.push(\"/account\");\n  } catch (error) {\n    console.tron.log(error);\n    yield errorHandler(error, signFailure);\n  }\n}\n\nfunction* signUp({\n  payload\n}) {\n  try {\n    const body = payload.body;\n\n    const _ref2 = yield race({\n      response: call(api.post, \"/user\", body),\n      timeout: call(timer)\n    }),\n          response = _ref2.response;\n\n    yield put(signUpSuccess(response.body));\n  } catch (error) {\n    yield errorHandler(error, signFailure);\n  }\n}\n\nfunction* restoreAccount({\n  payload\n}) {\n  try {\n    const username = payload.params.username;\n\n    const _ref3 = yield race({\n      response: call(api.put, \"/restore/\".concat(username)),\n      timeout: call(timer)\n    }),\n          response = _ref3.response;\n\n    yield put(restoreAccountSuccess(response.data));\n  } catch (error) {\n    yield errorHandler(error, signFailure);\n  }\n}\n\nexport function setToken({\n  payload\n}) {\n  if (!payload) return;\n  const token = payload.auth.token;\n\n  if (token) {\n    api.defaults.headers.Authorization = \"Bearer \".concat(token);\n  }\n}\nexport function signOut() {\n  api.defaults.headers.Authorization = null;\n  history.push(\"/\");\n}\nexport default all([takeLatest(\"persist/REHYDRATE\", setToken), takeLatest(\"@auth/SIGN_IN_REQUEST\", signIn), takeLatest(\"@auth/SIGN_UP_REQUEST\", signUp), takeLatest(\"@auth/RESTORE_ACCOUNT_SUCCESS\", restoreAccount), takeLatest(\"@auth/SIGN_OUT\", signOut)]);","map":{"version":3,"sources":["/home/daniel/Documents/Projetos/Software/Web/Reactjs/leigo_store/src/store/modules/auth/saga.js"],"names":["takeLatest","all","put","call","race","api","history","signInSuccess","signFailure","signUpSuccess","restoreAccountSuccess","errorHandler","timer","signIn","payload","body","response","post","timeout","console","tron","log","token","data","defaults","headers","Authorization","push","error","signUp","restoreAccount","username","params","setToken","auth","signOut"],"mappings":"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","sourcesContent":["import { takeLatest, all, put, call, race } from \"redux-saga/effects\";\nimport api from \"../../../services/api\";\nimport history from \"~/services/history\";\n\nimport {\n  signInSuccess,\n  signFailure,\n  signUpSuccess,\n  restoreAccountSuccess,\n} from \"./actions\";\n\nimport errorHandler from \"../utils/errorHandler\";\nimport timer from \"../utils/timer\";\n\nfunction* signIn({ payload }) {\n  const { body } = payload;\n  const { response } = yield race({\n    response: call(api.post, \"/session\", body),\n    timeout: call(timer),\n  });\n\n  console.tron.log(response);\n  try {\n    const { token } = response.data;\n    api.defaults.headers.Authorization = `Bearer ${token}`;\n\n    yield put(signInSuccess(response.data));\n    history.push(\"/account\");\n  } catch (error) {\n    console.tron.log(error);\n    yield errorHandler(error, signFailure);\n  }\n}\n\nfunction* signUp({ payload }) {\n  try {\n    const { body } = payload;\n\n    const { response } = yield race({\n      response: call(api.post, \"/user\", body),\n      timeout: call(timer),\n    });\n\n    yield put(signUpSuccess(response.body));\n  } catch (error) {\n    yield errorHandler(error, signFailure);\n  }\n}\n\nfunction* restoreAccount({ payload }) {\n  try {\n    const { username } = payload.params;\n\n    const { response } = yield race({\n      response: call(api.put, `/restore/${username}`),\n      timeout: call(timer),\n    });\n\n    yield put(restoreAccountSuccess(response.data));\n  } catch (error) {\n    yield errorHandler(error, signFailure);\n  }\n}\n\nexport function setToken({ payload }) {\n  if (!payload) return;\n\n  const { token } = payload.auth;\n\n  if (token) {\n    api.defaults.headers.Authorization = `Bearer ${token}`;\n  }\n}\n\nexport function signOut() {\n  api.defaults.headers.Authorization = null;\n\n  history.push(\"/\");\n}\n\nexport default all([\n  takeLatest(\"persist/REHYDRATE\", setToken),\n  takeLatest(\"@auth/SIGN_IN_REQUEST\", signIn),\n  takeLatest(\"@auth/SIGN_UP_REQUEST\", signUp),\n  takeLatest(\"@auth/RESTORE_ACCOUNT_SUCCESS\", restoreAccount),\n  takeLatest(\"@auth/SIGN_OUT\", signOut),\n]);\n"]},"metadata":{},"sourceType":"module"}